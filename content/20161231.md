Title: Brython Canvas 繪圖
Date: 2016-12-31 13:00
Category: Course
Tags: Brython
Author: yen

Brython Canvas 源自 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">Canvas API</a>, 以下將介紹 Brython 的繪圖對應 API 使用方法.

<!-- PELICAN_END_SUMMARY -->

<a href="https://simon.html5.org/dump/html5-canvas-cheat-sheet.html">html5 Canvas cheat sheet</a>

<a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial">Canvas tutorial</a>

<a href="https://developer.mozilla.org/en-US/docs/Web/Demos_of_open_web_technologies">Canvas demos</a>

<!-- 導入 Brython 標準程式庫 -->
<script type="text/javascript" 
    src="https://cdn.rawgit.com/brython-dev/brython/master/www/src/brython_dist.js">
</script>

<!-- 啟動 Brython -->
<script>
window.onload=function(){
brython(1);
}
</script>

<!-- 以下可以執行  Brython 程式 -->
<!-- div 標註區主要用來輸出字串 -->
<div id="div1"></div>
<!-- canvas 標註區則用來顯示繪圖內容
canvas default width 為 300 height 則為 150
-->
<canvas id="can1"></canvas>
<script type="text/python3">
from browser import document
from browser import html
canvas = document["can1"]
ctx = canvas.getContext("2d")

def greensquare(ev):
    ctx.fillStyle = "green"
    ctx.fillRect(10, 10, 100, 100)
    
def whitesquare(ev):
    ctx.fillStyle = "white"
    ctx.fillRect(10, 10, 100, 100)
    
document["but1"].bind("click", greensquare)
document["but2"].bind("click", whitesquare)
</script>
<button id="but1">畫綠色矩型</button>
<button id="but2">清除</button>

<pre class="brush: python"><div id="div1"></div>
<!-- canvas 標註區則用來顯示繪圖內容
canvas default width 為 300 height 則為 150
-->
<canvas id="can1"></canvas>
<script type="text/python3">
from browser import document
from browser import html
canvas = document["can1"]
ctx = canvas.getContext("2d")

def greensquare(ev):
    ctx.fillStyle = "green"
    ctx.fillRect(10, 10, 100, 100)
    
def whitesquare(ev):
    ctx.fillStyle = "white"
    ctx.fillRect(10, 10, 100, 100)
    
document["but1"].bind("click", greensquare)
document["but2"].bind("click", whitesquare)
</script>
<button id="but1">畫綠色矩型</button>
<button id="but2">清除</button>
</pre>

以下為基本動畫 (<a href="http://jsdo.it/Salvatore/hs65">程式來源</a>):

<div id="content"></div>
<script type="text/python3">
from browser import document
from browser import html
from browser import alert
from browser import timer

# 數列內容為圖檔的 URL 連結字串
listImages = [
              "https://nodebox.net/code/data/media/growing_things.jpg",
              "https://nodebox.net/code/data/media/neongolden.jpg"
              ]

# 以下3個變數, 其資料型別為 dictionary
dictImages = {}
dictRot = {}
dictAnim = {}

# anim 為動態繪圖對應變數
anim = None

def createIMG(id,src):
    i = 0
    for i in range(len(listImages)):
        dictImages[i] = html.IMG(src="%s"%listImages[i], id=i, alt="Nodebox 圖檔")
        dictImages[i].onclick = info 
        dictImages[i].onmouseover = rotateImage
        dictRot[i] = 0
        dictAnim[i] = False
        
def rotateImage(e):
    e.target.style.cursor = 'pointer'
    target = int(e.target.id)
    dictRot[target] += 45
    dictAnim[target] = True
    rot =  dictRot[target] 
    e.target.style.webkitTransform = "rotate(%sdeg)"%rot
           
def info(e):
    # 利用 alert() 顯示滑鼠點選 target 的 alt 資料
    alert(e.target.alt)

lenList = len(listImages)

for i in range(lenList):
    createIMG(i,listImages[i])
     
def startAnimation():
    global dictRot
    dictRot[0] += 3
    rot =  dictRot[0] 
    dictImages[0].style.webkitTransform = "rotate(%sdeg)"%rot
    dictImages[1].style.webkitTransform = "rotate(%sdeg)"%-rot

def launchAnimation(ev):
    global anim
    # 初始旋轉, anim 為 None
    if anim is None:
        anim = timer.set_interval(startAnimation, 30)
        # 初始旋轉後, 按鈕文字轉為"暫停旋轉"
        document['but3'].text = '暫停旋轉'
    elif anim == 'hold':
        # 當 anim 為 'hold' 表示曾經暫停後的旋轉, 因此持續以 set_interval() 持續旋轉, 且將 but3 文字轉為"暫停旋轉"
        anim = timer.set_interval(startAnimation, 30)
        document['but3'].text = '暫停旋轉'
    else:
        # 初始旋轉後, 使用者再按 but3, 此時 anim 非 None 也不是 'hold', 因此會執行 clear_interval() 暫停旋轉
        # 且將 anim 變數設為 'hold', 且 but3 文字轉為"繼續旋轉"
        timer.clear_interval(anim)
        anim = 'hold'
        document['but3'].text = '繼續旋轉'

for i in range(lenList):
    document["content"] <= dictImages[i]
document["but3"].bind("click", launchAnimation)
</script>
<button id="but3">旋轉圖檔</button><br /><br />
